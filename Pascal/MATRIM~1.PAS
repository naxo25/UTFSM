PROGRAM NUEVO;
USES CRT;
TYPE ST20 = STRING[20];
     PERSONA = RECORD
               ROL : INTEGER;
               NOMBRE : ST20;
               EDAD : BYTE;
            END;
     MATRIMONIO = RECORD
                  MASC,FEM          : ST20;
                  EDADMASC, EDADFEM : BYTE;
                END;
VAR HOMBRES,MUJERES: FILE OF PERSONA; CASADOS: FILE OF MATRIMONIO;
    SW : BYTE;

PROCEDURE ORDENARHOMBRES;
VAR I,J : INTEGER;
    BUF,BUF2 : PERSONA;
BEGIN
     RESET(HOMBRES);
     FOR I:=1 TO FILESIZE(HOMBRES)-1 DO
         FOR J:=0 TO FILESIZE(HOMBRES)-2 DO
         BEGIN
              SEEK(HOMBRES,J);
              READ(HOMBRES,BUF);
              SEEK(HOMBRES,J+1);
              READ(HOMBRES,BUF2);
              IF BUF.EDAD<BUF2.EDAD THEN
              BEGIN
                   SEEK(HOMBRES,J+1);
                   WRITE(HOMBRES,BUF);
                   SEEK(HOMBRES,J);
                   WRITE(HOMBRES,BUF2);
              END;
         END;
END;

PROCEDURE ORDENARMUJERES;
VAR I,J : INTEGER;
    BUF,BUF2 : PERSONA;
BEGIN
     RESET(MUJERES);
     FOR I:=1 TO FILESIZE(MUJERES)-1 DO
         FOR J:=0 TO FILESIZE(MUJERES)-2 DO
         BEGIN
              SEEK(MUJERES,J);
              READ(MUJERES,BUF);
              SEEK(MUJERES,J+1);
              READ(MUJERES,BUF2);
              IF BUF.EDAD<BUF2.EDAD THEN
              BEGIN
                   SEEK(MUJERES,J+1);
                   WRITE(MUJERES,BUF);
                   SEEK(MUJERES,J);
                   WRITE(MUJERES,BUF2);
              END;
         END;
END;

PROCEDURE CREARMATRIMONIOS;
VAR N              : BYTE;
    BUFFER,BUFFER1 : PERSONA;
    BUFFER2        : MATRIMONIO;
BEGIN
   REWRITE(CASADOS);
   RESET(HOMBRES);
   RESET(MUJERES);
   N:=0;
   FOR N:=0 TO FILESIZE(HOMBRES)-1 DO
   BEGIN
      SEEK(HOMBRES,N);
      READ(HOMBRES,BUFFER);
      RESET(MUJERES);
      WHILE NOT EOF (MUJERES) DO
      BEGIN
         READ(MUJERES,BUFFER1);
         IF (BUFFER.EDAD > BUFFER1.EDAD) AND (BUFFER.EDAD <> 0) AND (BUFFER1.EDAD <> 0) THEN
            BEGIN
            BUFFER2.MASC := BUFFER.NOMBRE;
            BUFFER2.FEM  := BUFFER1.NOMBRE;
            BUFFER2.EDADMASC := BUFFER.EDAD;
            BUFFER2.EDADFEM  := BUFFER1.EDAD;
            WRITE(CASADOS,BUFFER2);
            BUFFER.EDAD  := 0;
            BUFFER1.EDAD := 0;
            SEEK(HOMBRES,N);
            WRITE(HOMBRES,BUFFER);
            SEEK(MUJERES,FILEPOS(MUJERES)-1);
            WRITE(MUJERES,BUFFER1);
            END;
      END;
   END;
END;

PROCEDURE MAYOREDAD;
VAR BUFFER:MATRIMONIO;
BEGIN
   RESET(CASADOS);
   READ(CASADOS,BUFFER);
   WRITELN('NOMBRE ',BUFFER.MASC,' EDAD ',BUFFER.EDADMASC);
END;

PROCEDURE LISTARMATRIMONIO;
VAR N:BYTE; BUFFER:MATRIMONIO;
BEGIN
  RESET(CASADOS);
  FOR N:=0 TO FILESIZE(CASADOS)-1 DO
     BEGIN
     SEEK(CASADOS,N);
     READ(CASADOS,BUFFER);
     WRITE(BUFFER.MASC,'  ');
     WRITELN(BUFFER.EDADMASC,'  ');
     WRITE(BUFFER.FEM,'  ');
     WRITELN(BUFFER.EDADFEM,'  ');
     END;
END;

PROCEDURE SOLTEROS;
VAR BUFFER : PERSONA;
BEGIN
     WRITELN('SOLTEROS');
     RESET(HOMBRES);
     WHILE NOT EOF (HOMBRES) DO
     BEGIN
          READ(HOMBRES,BUFFER);
          IF BUFFER.EDAD>0 THEN
             WRITELN('NOMBRE ',BUFFER.NOMBRE,' EDAD ',BUFFER.EDAD);
     END;
     RESET(MUJERES);
     WHILE NOT EOF (MUJERES) DO
     BEGIN
          READ(MUJERES,BUFFER);
          IF BUFFER.EDAD>0 THEN
             WRITELN('NOMBRE ',BUFFER.NOMBRE,' EDAD ',BUFFER.EDAD);
     END;
     READLN;
END;

BEGIN
     CLRSCR;
     ASSIGN(HOMBRES,'HOMBRES.DAT');
     ASSIGN(MUJERES,'MUJERES.DAT');
     ASSIGN(CASADOS,'CASADOS.DAT');
     ORDENARHOMBRES;
     ORDENARMUJERES;
     {$I-}
     RESET(CASADOS);
     {$I+}
     IF IORESULT <> 0 THEN CREARMATRIMONIOS;
REPEAT
     CLRSCR;
            WRITELN('DIJITE EL NUMERO DE LO QUE DESEA HACER');
            WRITELN('0.- SALIR');
            WRITELN('1.-DESPLEGAR DATOS DE LA PERSONA DE MAYOR EDAD');
            WRITELN('2.-LISTAR MATRIMONIO');
            WRITELN('3.-LISTAR SOLTEROS');
            READLN(SW);
            IF SW = 1 THEN MAYOREDAD;
            IF SW = 2 THEN LISTARMATRIMONIO;
            IF SW = 3 THEN SOLTEROS;
     READLN;
UNTIL SW = 0;
READLN;
END.